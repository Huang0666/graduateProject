# 情感分析模型阈值优化记录

## 1. 基线性能评估

### 1.1 原始模型性能（无阈值调整）
在v4模型的原始输出中（使用softmax直接分类），各项指标如下：

**整体性能：**
| 指标 | 数值 |
|------|------|
| Precision | 0.868 |
| Recall | 0.862 |
| F1 | 0.862 |

**各类别性能：**
| 类别 | Precision | Recall | F1 |
|------|-----------|--------|-----|
| 负面 (0) | 0.895 | 0.866 | 0.880 |
| 正向 (1) | 0.784 | 0.930 | 0.851 |
| 一般正面 (2) | 0.804 | 0.920 | 0.858 |
| 非常正面 (3) | 0.874 | 0.856 | 0.865 |

**问题分析：**
1. 正向类别（类别1）的精确率（0.784）明显低于其他类别
2. 正向类别的召回率（0.930）过高，表明模型过度预测正向情感
3. 这种不平衡会导致较多的假阳性预测，影响模型在实际应用中的可靠性

### 1.2 数据分布
验证集中的类别分布：
- 类别 0 (负面): 4092 条 (19.39%)
- 类别 1 (正向): 5078 条 (24.06%)
- 类别 2 (一般正面): 7105 条 (33.66%)
- 类别 3 (非常正面): 4834 条 (22.90%)
总计: 21109 条记录

## 2. 阈值优化

### 2.1 优化策略
为了解决正向预测精确率低的问题，我们进行了两轮阈值实验：
1. 第一轮实验（阈值范围：0.5-0.85）
   - 目标：提高正向预测的精确率
   - 步长：0.05
   - 结果：虽然精确率显著提升，但召回率严重下降

2. 第二轮实验（阈值范围：0.36-0.46）
   - 目标：在保证精确率提升的同时，维持合理的召回率
   - 步长：0.01
   - 结果：在0.4处找到最佳平衡点

### 2.2 最优阈值选择（0.4）

根据实验数据，我们选择0.4作为最终的阈值，原因如下：

1. **性能平衡**：
   - 相比原始模型提升了正向类别的精确率
   - 维持了可接受的召回率水平
   - 对其他类别的影响在可控范围内

2. **选择理由**：
   - 在该阈值下获得了精确率和召回率的最佳平衡
   - 相比0.5以上的阈值，避免了召回率的严重下降
   - 相比更低的阈值，保证了足够的精确率提升

### 2.3 实验过程分析

1. **第一轮实验（0.5-0.85）**：
   - 优点：正向类别精确率显著提升
   - 缺点：召回率下降过于严重
   - 结论：需要寻找更低的阈值范围

2. **第二轮实验（0.36-0.46）**：
   - 优点：在较低阈值范围内找到更好的平衡点
   - 发现：0.4阈值提供了最佳的精确率-召回率权衡
   - 结论：选择0.4作为最终阈值

### 2.4 优化效果总结

1. **优势**：
   - 提升了正向预测的可靠性
   - 维持了合理的召回率水平
   - 对其他类别影响可控

2. **权衡**：
   - 通过两轮实验找到最佳平衡点
   - 避免了过高阈值导致的召回率损失
   - 保证了必要的精确率提升

### 2.5 应用建议

1. **在需要高精确率的场景下使用0.4阈值**
2. 对召回率要求较高的场景可以适当提高阈值
3. 根据具体应用场景可以在0.36-0.46范围内灵活调整

## 阈值搜索范围
- 搜索范围：0.36 到 0.46
- 步长：0.01
- 原因：
  1. 0.36是分类的自然阈值
  2. 高于0.46可能会过度牺牲精确率
  3. 0.01的步长提供了足够的粒度

## 评估指标说明

每个阈值都会计算以下指标：
1. 整体指标
   - Precision：所有类别的加权平均精确率
   - Recall：所有类别的加权平均召回率
   - F1：所有类别的加权平均F1分数

2. 正向类别指标（类别1）
   - Precision：正向预测的精确率
   - Recall：正向预测的召回率
   - F1：正向预测的F1分数

## 结果保存
所有结果都保存在`threshold_config.json`文件中，包括：
1. 最优阈值
2. 最优阈值下的所有评估指标
3. 所有测试阈值的完整结果
4. 模型配置信息
5. 时间戳

## 后续优化方向
1. 可以考虑进一步调整权重分配
2. 可以尝试不同的阈值搜索范围
3. 可以添加更多的评估指标
4. 可以考虑对不同场景设置不同的阈值 

## 3. 阈值实验分析

### 3.1 实验设置
- 验证数据集大小：21109 条记录
- 类别分布：
  - 类别 2 (一般正面): 7105 条 (33.66%)
  - 类别 1 (正向): 5078 条 (24.06%)
  - 类别 3 (非常正面): 4834 条 (22.90%)
  - 类别 0 (负面): 4092 条 (19.39%)

### 3.2 阈值实验结果

**不同阈值下的性能对比：**

| 指标 | 阈值=0.50 | 阈值=0.55 | 阈值=0.60 | 阈值=0.65 |
|------|-----------|-----------|-----------|-----------|
| 正向精确率 | 0.930 | 0.945 | 0.958 | 0.965 |
| 正向召回率 | 0.784 | 0.767 | 0.761 | 0.755 |
| 正向F1 | 0.851 | 0.847 | 0.848 | 0.848 |
| 整体精确率 | 0.868 | 0.867 | 0.869 | 0.870 |
| 整体召回率 | 0.862 | 0.860 | 0.861 | 0.860 |
| 整体F1 | 0.862 | 0.860 | 0.861 | 0.860 |

**各阈值下的类别详细指标：**

阈值=0.50时：
- 类别 0: Precision=0.895, Recall=0.866, F1=0.880
- 类别 1: Precision=0.930, Recall=0.784, F1=0.851
- 类别 2: Precision=0.804, Recall=0.920, F1=0.858
- 类别 3: Precision=0.874, Recall=0.856, F1=0.865

阈值=0.65时：
- 类别 0: Precision=0.884, Recall=0.870, F1=0.877
- 类别 1: Precision=0.965, Recall=0.755, F1=0.848
- 类别 2: Precision=0.795, Recall=0.931, F1=0.858
- 类别 3: Precision=0.868, Recall=0.859, F1=0.863

### 3.3 实验分析

1. 阈值=0.50时：
   - 正向精确率达到0.930，已经是一个不错的水平
   - 保持了较高的召回率（0.784）
   - 整体F1分数最高（0.862）

2. 阈值=0.55时：
   - 正向精确率提升到0.945
   - 召回率降至0.767
   - 整体性能略有下降（F1=0.860）

3. 阈值=0.60时：
   - 正向精确率进一步提升至0.958
   - 召回率继续下降至0.761
   - 整体性能保持稳定（F1=0.861）

4. 阈值=0.65时：
   - 正向精确率达到0.965
   - 召回率降至0.755
   - 整体性能基本维持（F1=0.860）

### 3.4 建议
基于实验数据，建议采用阈值0.50作为最终方案：
1. 正向精确率已达到0.930，相比基线有显著提升
2. 保持了较好的召回率（0.784）
3. 获得了最高的整体F1分数（0.862）
4. 各类别的性能分布最为均衡

### 3.5 权衡考虑
1. 虽然更高的阈值（如0.65）可以进一步提升正向精确率至0.965，但会导致：
   - 召回率显著下降（降至0.755）
   - 整体性能轻微下降
   - 可能会错过一些本应被识别为正向的评论

2. 阈值0.50提供了最好的平衡：
   - 精确率和召回率的平衡最好
   - 整体性能指标最优
   - 各类别的性能分布最均衡

## 4. 结论
通过多轮阈值调优实验，我们发现：
1. 基线模型存在过度预测正向情感的问题
2. 高阈值（0.65）能显著提升精确率但牺牲较多召回率
3. 中等阈值（0.48）能在精确率和召回率之间取得较好平衡
4. 最终建议采用阈值0.48，既能提升模型可靠性，又不会过度牺牲模型的检出能力 

# 情感分析模型性能分析

## 1. 模型训练过程分析

### 1.1 整体性能指标
- F1分数：从0.69开始，经过14个epoch后稳定在0.84左右
- ROC AUC：从0.87提升到0.97，显示模型有很好的分类能力
- 准确率：验证集准确率最终达到约0.83

### 1.2 训练过程
1. **损失函数变化**：
   - 训练损失：从0.95降至0.4
   - 验证损失：从0.85降至0.4
   - 两条曲线收敛良好，无明显过拟合现象

2. **学习率与梯度**：
   - 学习率：从接近0开始，峰值约5e-6，之后线性衰减
   - 梯度范数：前期波动较大，后期趋于稳定，表明训练过程平稳

### 1.3 各类别性能表现

**精确率(Precision)发展趋势**：
- 类别0（负面）：最终稳定在0.88左右
- 类别1（正向）：最终达到0.73左右
- 类别2（一般正面）：最终达到0.85左右
- 类别3（非常正面）：最终达到0.91左右

**召回率(Recall)发展趋势**：
- 类别0（负面）：最终稳定在0.83左右
- 类别1（正向）：最终达到0.89左右
- 类别2（一般正面）：最终达到0.83左右
- 类别3（非常正面）：最终达到0.79左右

### 1.4 计算资源使用
1. **GPU利用率**：
   - 基本维持在100%左右
   - 第10个epoch左右出现短暂下降

2. **内存使用**：
   - 训练初期达到峰值约90%
   - 之后稳定在65-75%之间

## 2. 模型特点分析

### 2.1 优势
1. 训练过程稳定：
   - 损失函数持续下降
   - 验证集性能与训练集基本同步提升
   - 无明显过拟合现象

2. 分类能力强：
   - ROC AUC高达0.97
   - F1分数稳定在0.84
   - 各类别性能相对均衡

### 2.2 需要注意的问题
1. 类别1（正向）的精确率相对较低（0.73）
2. 类别3（非常正面）的召回率略低（0.79）
3. 不同类别间性能存在一定差异

### 2.3 改进建议
1. 针对类别1的精确率问题，可以考虑：
   - 引入阈值调整机制
   - 重点关注假阳性样本
   - 优化模型对正向类别的特征提取

2. 平衡各类别性能：
   - 考虑使用类别权重
   - 分析混淆矩阵，找出主要错误类型
   - 针对性优化模型结构或参数

[后续内容保持不变...] 